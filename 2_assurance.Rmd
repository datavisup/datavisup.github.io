---
title: "Séance 2: Exemples de visualisation en assurance"
output:
    html_document:
      toc: true
      toc_float: true
      number_sections: false
      theme: journal
      highlight: textmate
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message=FALSE, warning=FALSE)
```

```{r eval=FALSE, echo=FALSE}
rmarkdown::render_site()
install.packages("knitr")
install.packages("rmarkdown")
install.packages("ggvis")
install.packages("googleVis")
install.packages("corrplot")
install.packages("PerformanceAnalytics")

```

```{r}
library(ggplot2)
library(plotly)
```

# Objectif

La première séance a pour but de se familiarer avec les différents graphiques réalisables avec R. Cette deuxième séance est divisée en deux parties:

- mieux communiquer les informations sur les données en assurance
- mieux comprendre certaines notions techniques actuarielles

Dans la continuité de la première séance, il s'agit d'utiliser les graphiques de base pour mieux représenter les données.

# Données

## Données R

**Séries de données dans certains packages R**

```{r echo=TRUE}
library(MASS)
head(Insurance)
head(Boston)
library(Ecdat)
head(HI)
head(Mofa)
library(evir)
data(danish)
head(danish)
# str(danish)
# typeof(danish)
# plot(danish)

```

## Open Data

Les données sont sur les leurs sites

- [Données météorologiques](http://eca.knmi.nl/dailydata/index.php)
- [Données sur les sinistres automobiles corporels](https://www.data.gouv.fr/fr/datasets/base-de-donnees-accidents-corporels-de-la-circulation/)


Pour ceux qui du temps restant : 

- [Correspondance code postal insee 2013 avec altitude, superficie, population et gécodage](http://public.opendatasoft.com/explore/dataset/correspondance-code-insee-code-postal/)
- [Carte des Codes Postaux 2016](http://datanova.legroupe.laposte.fr/explore/dataset/carte-des-codes-postaux/table/): données de la Poste, centroïdes des codes postaux
- [Catégories socio-professionnelles](http://public.opendatasoft.com/explore/dataset/evolution-et-structure-de-la-population-france-2012-categories-socio-professionn/information/)
- [Migrations résidentielles](http://public.opendatasoft.com/explore/dataset/evolution-et-structure-de-la-population-france-2012-migrations-residentielles/information/)
- [Résumés statistiques des communes, départements et régions](http://public.opendatasoft.com/explore/dataset/resume-statistique-communes-departements-et-regions-france-2012-2013-2014/)
- [Capacités des communes en hébergement touristique](http://public.opendatasoft.com/explore/dataset/capacite-des-communes-en-hebergement-touristique-2015/)
- [Revenus imposables et montants des impôts](http://public.opendatasoft.com/explore/dataset/revenus-imposables-et-montant-des-impots-1998-2005/)
- [Equipement sports et loisir par commune](http://public.opendatasoft.com/explore/dataset/equip-sport-loisir-socio-infra-2014/)
- [Décès par commune, départements et régions](http://public.opendatasoft.com/explore/dataset/deces-par-commune-departement-et-region-de-2003-a-2013/)


# Types de graphiques

A part les graphiques basiques vus à la première séance, on peut utiliser d'autres graphiques plus avancés.

## Treemap

```{r}
library(treemap)
head(Insurance)
Ins=Insurance
Ins$Freq=Ins$Claims/Ins$Holders
treemap(Ins,
        index=c("District","Group","Age"),
        vSize="Holders",
        vColor="Freq",
        type="value")
```

## Sunbrust

<iframe src="sunburst_accidents_auto.html" width="760" height="800" frameborder="0" marginheight="0" marginwidth="0">Chargement en cours...</iframe>


## Quelques suggestions de graphiques

Pour les données météorologiques, on peut choisir une ville donnée

- Evolution des températures (pression, quantité de pluie, etc) avec dygraphs
- Corrélation des différentes grandeurs
- Tendance et saisonnalité

Pour les données sur les accidents

- Analyse des lieux d'accidents
- Analyse des parties accidentées
- Evolution temporelles de certaines caractéristiques

Dans les deux cas, la situation géographique est très importante. Pour vous préparer la prochaine séance, vous pouvez lire la documentation sur [leafet pour R](https://rstudio.github.io/leaflet/).

Pour les données concernant la population, on peut utiliser les [pyramides](http://walkerke.github.io/2014/06/rcharts-pyramids/)

# Paramètres graphiques

Vous devez également prêter attention aux différents éléments suivants: 

- Titre principal
- Titres des axes x et y
- Couleurs, formes des symboles
- Couleur de l'arrière-plan
- Polices des caractères
- Légende (position et textes)

# Interactivité

## plotly

Les packages pour des graphiques interactifs: plotly (de plus en plus développé), rCharts, highcharter, googleVis

Le package plotly permet de convertier un graphique créé avec ggplot2 (la plupart d'entre eux) en un graphique interactif grâce à la fonction `ggplotly`.

```{r echo=TRUE}
head(Insurance)
p=ggplot(data=Insurance,aes(Age,Holders,color=District))+geom_jitter()
ggplotly(p)
```

## dygraphs

```{r}
library(dygraphs)
```

```{r}
dygraph(nhtemp, main = "New Haven Temperatures") %>% 
  dyRangeSelector()
```


